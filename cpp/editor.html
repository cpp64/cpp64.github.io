<html>
   <head>
      <script type="text/javascript" src="/jquery-3.7.1.min.js" ></script>
      <script>$(function(){$("head").load("/head.html")});</script>
      <script>$(function(){$("#navigation").load("/navigation.html")});</script>
      <title>C++ базовый</title>
      <link rel="stylesheet" href="codemirror/codemirror.css">
      <style>
         .CodeMirror {border: 1px inset #dee;}
      </style>
   </head>
   <body>
      <div id="navigation"></div>
      <div class="main">
         <div id="codediv" style="position: absolute; width: 350px; height: 300px; top: 0px; left: 10px;"></div>
         <script src="codemirror/codemirror.js"></script>
         <script src="codemirror/matchbrackets.js"></script>
         <script src="codemirror/clike.js"></script>
         <script src="JSCPP.es5.min.js"></script>
         <script src="velosiped.js"></script>
         <script type="text/javascript">
            //сделать textarea не мпсштабируемыми
            //JSCPP: iostream нельзя подключать раньше, чем stdio.h
            putButton("0px","0px","Запуск","run()","run button");
            putButton("8px","0px","Копировать код","cod()","cod button");
            var cppEditor = CodeMirror(
               document.getElementById("codediv"),
               {
                   lineNumbers: true,
                   matchBrackets: true,
                   mode: "text/x-c++src"
               }
            );
            putTextArea('8px','0px','10','70','2');
            putTextArea('8px','0px','10','70','3');
            putText("8px","50px","Код", "text1");
            putText("8px","0px","Вход", "text2");
            putText("8px","0px","Выход", "text3");
            appendBottom("codediv", "text1");
            appendBottom1("text2", "codediv", 10);
            appendBottom("2", "text2");
            appendBottom("text3", "2");
            appendBottom("3", "text3");
            appendBottom("run button", "3");
            appendBottom("cod button", "3");
            alignRight("run button", "3");
            document.getElementById("codediv").style.width =
            document.getElementById("2").offsetWidth;
            var precode1 = 
               "#include <cmath>\n" +
               "#include <iostream>\n" +
               "using namespace std;\n" +
               "int main(){\n";
            var precode2 = 
               "#include <cmath>\n" +
               "#include <iostream>\n" +
               "#define or ||\n" +
               "#define and &&\n" +
               "#define bool int\n" +
               "using namespace std;\n" +
               "int main(){\n";
            var postcode = "\nreturn 0;\n}";
            function cod() {navigator.clipboard.writeText(precode1 + cppEditor.getValue() + postcode);}
            function run() {
                var output = "";
                var config = {stdio:{write:function(s){output += s;}}};
                var code = precode2 + cppEditor.getValue() + postcode;
                var input = document.getElementById("2").value;
                var exitCode;
                try {
                   exitCode = JSCPP.run(code, input, config);
                   document.getElementById("3").value = output;
                } catch(err) {
                   document.getElementById("3").value = "Error: " + (err.message || err);
                }
            }
         </script>
      </div>
   </body>
</html>
